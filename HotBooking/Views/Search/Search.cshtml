@using HotBooking.Domain.Entities
@using System.IO
@using HotBooking
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@inject IHtmlLocalizer<CommonResources> SharedLocalizer

@model List<KeyValuePair<Hotel, bool>>
@{
    Layout = "_LayoutSearch";
}
<body>
    <div class="wrapper">
        <div class="content">
            <div class="container">
                <div class="content__row">
                    <aside>
                        @await Html.PartialAsync("AsideForm")

                        <form asp-controller="Search" asp-action="Filter">
                            <div class="aside__filter-by">
                                <div class="filter-by__title">
                                    @SharedLocalizer["Filter by:"]
                                </div>
                                <hr>
                                <div class="filter-by__item">
                                    <div class="filter-by__title2">
                                        @SharedLocalizer["Your budget (per night)"]
                                    </div>
                                    <div class="filter-by__options">
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="budget" value="31400">
                                                <div class="options__desc">
                                                    AMD 0 - AMD 31,400
                                                </div>
                                            </div>
                                            <div class="options__count">435</div>
                                        </div>
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="budget" value="62800">
                                                <div class="options__desc">
                                                    AMD 31,400 - AMD 62,800
                                                </div>
                                            </div>
                                            <div class="options__count">435</div>
                                        </div>
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="budget" value="94300">
                                                <div class="options__desc">
                                                    AMD 62,800 - AMD 94,300
                                                </div>
                                            </div>
                                            <div class="options__count">435</div>
                                        </div>
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="budget" value="125000">
                                                <div class="options__desc">
                                                    AMD 94,300 - AMD 125,000
                                                </div>
                                            </div>
                                            <div class="options__count">435</div>
                                        </div>
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="budget" value="@int.MaxValue">
                                                <div class="options__desc">
                                                    AMD 125,000 +
                                                </div>
                                            </div>
                                            <div class="options__count">435</div>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="filter-by__item">
                                    <div class="filter-by__title2">
                                        @SharedLocalizer["Star rating"]
                                    </div>
                                    <div class="filter-by__options">
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="stars" value="1">
                                                <div class="options__desc">
                                                    1 @SharedLocalizer["star"]
                                                </div>
                                            </div>
                                            <div class="options__count">15</div>
                                        </div>
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="stars" value="2">
                                                <div class="options__desc">
                                                    2 @SharedLocalizer["stars"]
                                                </div>
                                            </div>
                                            <div class="options__count">65</div>
                                        </div>
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="stars" value="3">
                                                <div class="options__desc">
                                                    3 @SharedLocalizer["stars"]
                                                </div>
                                            </div>
                                            <div class="options__count">409</div>
                                        </div>
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="stars" value="4">
                                                <div class="options__desc">
                                                    4 @SharedLocalizer["stars"]
                                                </div>
                                            </div>
                                            <div class="options__count">237</div>
                                        </div>
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="stars" value="5">
                                                <div class="options__desc">
                                                    5 @SharedLocalizer["stars"]
                                                </div>
                                            </div>
                                            <div class="options__count">43</div>
                                        </div>
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="stars" value="0">
                                                <div class="options__desc">
                                                    @SharedLocalizer["Unrated"]
                                                </div>
                                            </div>
                                            <div class="options__count">159</div>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="filter-by__item">
                                    <div class="filter-by__title2">
                                        @SharedLocalizer["Distance from centre of"]
                                    </div>
                                    <div class="filter-by__options">
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="distance" value="1">
                                                <div class="options__desc">
                                                    @SharedLocalizer["Less than 1km"]
                                                </div>
                                            </div>
                                            <div class="options__count">75</div>
                                        </div>
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="distance" value="3">
                                                <div class="options__desc">
                                                    @SharedLocalizer["Less than 3km"]
                                                </div>
                                            </div>
                                            <div class="options__count">492</div>
                                        </div>
                                        <div class="options__row">
                                            <div class="options__row_inner">
                                                <input type="checkbox" name="distance" value="5">
                                                <div class="options__desc">
                                                    @SharedLocalizer["Less than 5km"]
                                                </div>
                                            </div>
                                            <div class="options__count">869</div>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="filter-by__item">
                                    <div class="filter-by__title2">
                                        @SharedLocalizer["Facilities"]
                                    </div>
                                    <div class="filter-by__options">
                                        @foreach (var facility in ViewBag.Facilities)
                                        {
                                            <div class="options__row">
                                                <div class="options__row_inner">
                                                    <input type="checkbox" name="hotelFacilities" value="@facility.Id">
                                                    <div class="options__desc">
                                                        @facility.Title
                                                    </div>
                                                </div>
                                                <div class="options__count">574</div>
                                            </div>
                                        }
                                    </div>
                                </div>
                                <hr>
                                <div class="filter-by__item">
                                    <div class="filter-by__title2">
                                        @SharedLocalizer["Room facilities"]
                                    </div>
                                    <div class="filter-by__options">
                                        @foreach (var facility in ViewBag.RoomFacilities)
                                        {
                                            <div class="options__row">
                                                <div class="options__row_inner">
                                                    <input type="checkbox" name="roomFacilities" value="@facility.Id">
                                                    <div class="options__desc">
                                                        @facility.Title
                                                    </div>
                                                </div>
                                                <div class="options__count">574</div>
                                            </div>
                                        }
                                    </div>
                                </div>
                                @foreach (var item in Model)
                                {
                                    <input name="hotelsId" value="@item.Key.Id" hidden />
                                }
                                <input name="destination" value="@ViewBag.DestinationName" hidden />
                                <button type="submit" class="submit">@Localizer["Filter"]</button>
                            </div>
                        </form>
                    </aside>
                    <main>
                        <article>
                            <div class="article__title">
                                <h2>@ViewBag.DestinationName: @Model.Count(x => x.Value) @Localizer["properties found"]</h2>
                                <button class="filter__btn">
                                    <img src="~/images/icons/filter.webp" alt="Alternate Text" />
                                </button>
                            </div>
                            @foreach (var hotel in Model.Where(x => x.Value))
                            {
                                <div class="search__card">
                                    <div class="card__row">
                                        <div class="card__left">
                                            <div class="card__image">
                                                <img src="~/@hotel.Key.TitleImagePath" alt="">
                                            </div>
                                            <div class="card__desc">
                                                <div class="card__head">
                                                    <div class="card__title">
                                                        @hotel.Key.Title
                                                    </div>
                                                    <div>
                                                        @for (var i = 0; i < hotel.Key.Stars; i++)
                                                        {
                                                            <img src="~/images/icons/star.png" alt="" style="width: 30px; height: 30px; display: inline;" />
                                                        }
                                                    </div>
                                                </div>
                                                <div class="card__subtitle">
                                                    <p>@hotel.Key.Adress, @hotel.Key.City.Title  @hotel.Key.DistanceToCenter km from centre</p>
                                                    <p>@hotel.Key.Subtitle</p>
                                                    <p>
                                                        @foreach (var item in ViewBag.Facilities)
                                                        {
                                                            @item.Title<span>, </span>
                                                        }
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card__info">
                                            <div class="review">
                                                <div class="review__text">
                                                    @{
                                                        string str;
                                                        if (@hotel.Key.ReviewRating >= 9)
                                                        {
                                                            str = @Localizer["Superb"].Value;
                                                        }
                                                        else if (@hotel.Key.ReviewRating >= 8)
                                                        {
                                                            str = @Localizer["Very Good"].Value;
                                                        }
                                                        else if (@hotel.Key.ReviewRating >= 7)
                                                        {
                                                            str = @Localizer["Good"].Value;
                                                        }
                                                        else if (@hotel.Key.ReviewRating >= 6)
                                                        {
                                                            str = @Localizer["Pleasant"].Value;
                                                        }
                                                        else
                                                        {
                                                            str = @Localizer["Bad"].Value;
                                                        }
                                                    }
                                                    <p>@str</p>
                                                    <p>@hotel.Key.Reviews.Count @Localizer["reviews"]</p>
                                                </div>
                                                <div class="review__digit">
                                                    @Math.Round(hotel.Key.ReviewRating, 1)
                                                </div>
                                            </div>
                                            <div class="price">
                                                AMD @{ var price = 0.0M;
                                                    if (hotel.Key.Rooms?.Count != 0)
                                                    {
                                                        price = hotel.Key.Rooms?.Aggregate((curr, next) => (curr == null || next.PricePerNight < curr.PricePerNight) ? next : curr)?.PricePerNight ?? 0.0M;
                                                    }
                                                }
                                                @price
                                            </div>
                                            <form asp-controller="Hotel" asp-action="Hotel" method="post" style="z-index: 100;">
                                                <input type="text" name="hotelId" value="@hotel.Key.Id" hidden />
                                                <input type="text" name="arrival" value="@ViewBag.Arrival" hidden />
                                                <input type="text" name="departure" value="@ViewBag.Departure" hidden />
                                                <input type="text" name="guests" value="@ViewBag.Guests" hidden />
                                                <input type="text" name="roomsCount" value="@ViewBag.Rooms" hidden />
                                                <button type="submit" class="submit">@Localizer["See availability"]</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            }
                        </article>
                    </main>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            $('.filter__btn').click(function (event) {
                $('.aside__filter-by').toggleClass('active');
            });
        });
    </script>
</body>